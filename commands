#!/usr/bin/env bash
set -eo pipefail; [[ $DOKKU_TRACE ]] && set -x
source "$(dirname $0)/../common/functions"

case "$1" in
  grunt)
    [[ -z $2 ]] && echo "Please specify an app to run the command on" && exit 1
    verify_app_name "$2"
    APP="$2"
                                                                                
    if [[ -z $3 ]]; then
        echo "Usage: dokku grunt APP BUILDTYPE"
        exit 1
    fi
                                                                                
    TYPE="$3"
    # Compile with Grunt
    echo "-----> Compiling with grunt build:$TYPE"
    new_path="$(find / -name npm)" 

    echo "$new_path"
    command -v npm >/dev/null 2>&1 || echo 'error npm'
    command -v grunt >/dev/null 2>&1 || echo 'error grunt'
    echo "-----> Deploying $APP ..."
    dokku deploy $APP
    echo "-----> Deploy complete!"

    ;;

  help)
    cat && cat<<EOF
    grunt <app> <build_type>                        Use Grunt to build
EOF
    ;;

  *)
    exit $DOKKU_NOT_IMPLEMENTED_EXIT
    ;;

esac
